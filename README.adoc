= SwitchAPI
:toc:
:toc-placement!:

image:https://img.shields.io/badge/vert.x-5.0.6-purple.svg[link="https://vertx.io"]
image:https://img.shields.io/badge/kotlin-2.1.0-blue.svg[link="https://kotlinlang.org"]
image:https://img.shields.io/badge/jvm-21-orange.svg[link="https://adoptium.net"]

Reactive REST API Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸ (switches) Ñ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼. ĞŸĞ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ½Ğ° Vert.x 5.0.6 Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Kotlin, PostgreSQL Ğ¸ JWT Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸.

toc::[]

== Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸

* ğŸ” JWT Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ Argon2id Ñ…ĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ¿Ğ°Ñ€Ğ¾Ğ»ĞµĞ¹
* ğŸ”„ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸ (SWITCH/BUTTON Ñ‚Ğ¸Ğ¿Ñ‹)
* ğŸŒ ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ñ‚ĞµĞ»ÑĞ¼ Ğ¿Ğ¾ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ ĞºĞ¾Ğ´Ñƒ
* ğŸ“ OpenAPI 3.1 ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸ĞµĞ¹
* ğŸ¨ Swagger UI Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ API
* âš¡ Ğ ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ° EventBus
* ğŸ›¡ï¸ Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
* âœ… ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ°Ğ¼Ğ¸ (34 Ñ‚ĞµÑÑ‚Ğ°)

== ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

[source]
----
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MainVerticle                           â”‚
â”‚              (Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ°, Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹ verticles)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      HttpVerticle       â”‚     â”‚     DatabaseVerticle        â”‚
â”‚  (HTTP server, routing) â”‚     â”‚  (EventBus handlers, repos) â”‚
â”‚                         â”‚     â”‚                             â”‚
â”‚  RouterFactory          â”‚     â”‚  UserRepository             â”‚
â”‚    â”œâ”€ HealthHandler     â”‚     â”‚  SwitchRepository           â”‚
â”‚    â”œâ”€ AuthHandler â”€â”€â”€â”€â”€â”€â”¼â”€â”€EventBusâ”€â”€â–¶ handlers            â”‚
â”‚    â”œâ”€ SwitchHandler â”€â”€â”€â”€â”¼â”€â”€EventBusâ”€â”€â–¶ handlers            â”‚
â”‚    â””â”€ PublicSwitchHandler                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
----

=== ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

[source]
----
HTTP Request
    â†“
OpenAPI Router â†’ Handler (protected by JWT/Owner middleware)
    â†“
EventBus.request(address, JsonObject)
    â†“
DatabaseVerticle â†’ Repository â†’ PostgreSQL
    â†“
EventBus reply (JsonObject)
    â†“
Handler â†’ HTTP Response (JSON)
----

== Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

[source]
----
src/main/kotlin/com/example/switcher/
â”œâ”€â”€ MainVerticle.kt              # Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ°, Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹ verticles
â”œâ”€â”€ RouterFactory.kt             # Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¾Ğ², ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ handlers
â”œâ”€â”€ config/
â”‚   â””â”€â”€ AppConfig.kt             # Data class Ğ´Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸
â”œâ”€â”€ verticle/
â”‚   â”œâ”€â”€ HttpVerticle.kt          # HTTP ÑĞµÑ€Ğ²ĞµÑ€
â”‚   â””â”€â”€ DatabaseVerticle.kt      # EventBus handlers, Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸
â”œâ”€â”€ handler/
â”‚   â”œâ”€â”€ HealthHandler.kt         # GET /api/health
â”‚   â”œâ”€â”€ AuthHandler.kt           # POST /api/register, POST /api/login
â”‚   â”œâ”€â”€ SwitchHandler.kt         # CRUD switches (EventBus â†’ DatabaseVerticle)
â”‚   â”œâ”€â”€ PublicSwitchHandler.kt   # GET /public/:code
â”‚   â””â”€â”€ GlobalErrorHandler.kt    # Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
â”œâ”€â”€ error/
â”‚   â”œâ”€â”€ AppException.kt          # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¹
â”‚   â”œâ”€â”€ ValidationException.kt   # ĞÑˆĞ¸Ğ±ĞºĞ¸ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ (400)
â”‚   â”œâ”€â”€ NotFoundException.kt     # Ğ ĞµÑÑƒÑ€Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ (404)
â”‚   â”œâ”€â”€ UnauthorizedException.kt # Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ (401)
â”‚   â”œâ”€â”€ ForbiddenException.kt    # Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½ (403)
â”‚   â”œâ”€â”€ BadRequestException.kt   # ĞĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ (400)
â”‚   â””â”€â”€ response/
â”‚       â”œâ”€â”€ ErrorResponse.kt     # Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° JSON Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
â”‚       â””â”€â”€ ValidationError.kt   # ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»Ñ
â”œâ”€â”€ repository/
â”‚   â”œâ”€â”€ UserRepository.kt        # SQL Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ´Ğ»Ñ users
â”‚   â””â”€â”€ SwitchRepository.kt      # SQL Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ´Ğ»Ñ switches
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ User.kt                  # data class User
â”‚   â””â”€â”€ Switch.kt                # data class Switch
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ request/                 # DTO Ğ´Ğ»Ñ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
â”‚   â””â”€â”€ response/                # DTO Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ JwtAuthMiddleware.kt     # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° JWT Ñ‚Ğ¾ĞºĞµĞ½Ğ°
â”‚   â””â”€â”€ CheckSwitchOwnerMiddleware.kt # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° switch
â”œâ”€â”€ service/
â”‚   â””â”€â”€ JwtService.kt            # Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ JWT
â””â”€â”€ util/
    â””â”€â”€ PasswordHasher.kt        # Ğ¥ĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ĞµĞ¹ (Argon2)
----

== Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

=== Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

* JDK 21+
* Docker Ğ¸ Docker Compose (Ğ´Ğ»Ñ PostgreSQL)
* Gradle 8.5+

=== Ğ—Ğ°Ğ¿ÑƒÑĞº

1. **Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ PostgreSQL:**
+
[source,bash]
----
docker-compose up -d
----

2. **Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚:**
+
[source,bash]
----
./gradlew clean assemble
----

3. **Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ:**
+
[source,bash]
----
./gradlew run
----

4. **ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Swagger UI:**
+
http://localhost:8080/swagger-ui/index.html

=== Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ‚ĞµÑÑ‚Ğ¾Ğ²

[source,bash]
----
./gradlew cleanTest test
----

Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: *34/34 Ñ‚ĞµÑÑ‚Ğ¾Ğ² PASSED* âœ…

== API Endpoints

=== ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ (Ğ±ĞµĞ· Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸)

[cols="1,3,4"]
|===
| Method | Endpoint | Description

| GET
| `/api/health`
| Health check

| POST
| `/api/register`
| Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

| POST
| `/api/login`
| ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ JWT Ñ‚Ğ¾ĞºĞµĞ½)

| GET
| `/api/public/{code}`
| ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ğ¾ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ¼Ñƒ ĞºĞ¾Ğ´Ñƒ
|===

=== Ğ—Ğ°Ñ‰Ğ¸Ñ‰Ñ‘Ğ½Ğ½Ñ‹Ğµ (Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ JWT)

[cols="1,3,4"]
|===
| Method | Endpoint | Description

| GET
| `/api/switches`
| Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… switches Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

| GET
| `/api/switches/{id}`
| ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ switch Ğ¿Ğ¾ ID

| POST
| `/api/switches`
| Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ switch

| PUT
| `/api/switches/{id}/toggle`
| ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ switch (ON/OFF)

| DELETE
| `/api/switches/{id}`
| Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ switch
|===

== ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº

=== Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ

Ğ’ÑĞµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ÑÑ‚ÑÑ Ğ² ĞµĞ´Ğ¸Ğ½Ğ¾Ğ¼ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¼ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ:

[source,json]
----
{
  "error": "Validation Error",
  "message": "Invalid input data",
  "errorCode": "VALIDATION_ERROR",
  "statusCode": 400,
  "validationErrors": [
    {
      "field": "email",
      "message": "Email already exists",
      "code": "EMAIL_EXISTS"
    }
  ],
  "timestamp": "2026-01-09T12:34:56Z",
  "path": "/api/register"
}
----

=== HTTP ÑÑ‚Ğ°Ñ‚ÑƒÑ ĞºĞ¾Ğ´Ñ‹

[cols="1,3,4"]
|===
| ĞšĞ¾Ğ´ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | ĞŸÑ€Ğ¸Ğ¼ĞµÑ€

| 200
| OK
| Ğ£ÑĞ¿ĞµÑˆĞ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ

| 201
| Created
| Ğ ĞµÑÑƒÑ€Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½

| 204
| No Content
| Ğ ĞµÑÑƒÑ€Ñ ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½

| 400
| Bad Request
| ĞĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ, Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ UUID

| 401
| Unauthorized
| ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚/Ğ½ĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½

| 403
| Forbidden
| Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½ (Ğ½Ğµ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ†)

| 404
| Not Found
| Ğ ĞµÑÑƒÑ€Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½

| 500
| Internal Server Error
| Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°
|===

=== ĞšĞ¾Ğ´Ñ‹ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ

[cols="2,4,1"]
|===
| errorCode | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | HTTP

| `VALIDATION_ERROR`
| ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
| 400

| `EMAIL_EXISTS`
| Email ÑƒĞ¶Ğµ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
| 400

| `BAD_REQUEST`
| ĞĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
| 400

| `UNAUTHORIZED`
| Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
| 401

| `FORBIDDEN`
| Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½
| 403

| `NOT_FOUND`
| Ğ ĞµÑÑƒÑ€Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½
| 404

| `REGISTRATION_FAILED`
| ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸
| 500

| `LOGIN_FAILED`
| ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°
| 500

| `SWITCH_CREATION_FAILED`
| ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ñ‚ĞµĞ»Ñ
| 500

| `SWITCH_TOGGLE_FAILED`
| ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
| 500

| `SWITCH_DELETION_FAILED`
| ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°Ñ‚ĞµĞ»Ñ
| 500
|===

=== Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² ĞºĞ¾Ğ´Ğµ

[source,kotlin]
----
// Ğ Ğ°Ğ½ÑŒÑˆĞµ
if (switchNotFound) {
  ctx.response().setStatusCode(404).end()
}

// Ğ¢ĞµĞ¿ĞµÑ€ÑŒ
throw NotFoundException("Switch", id)
// Ğ¸Ğ»Ğ¸
ctx.fail(NotFoundException("Switch", id))
----

`GlobalErrorHandler` Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·ÑƒĞµÑ‚ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ² ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ JSON Ğ¾Ñ‚Ğ²ĞµÑ‚.

==== ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹

[source,kotlin]
----
// Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ğ¼Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ğ¼Ğ¸ Ğ¿Ğ¾Ğ»ĞµĞ¹
throw ValidationException(listOf(
  ValidationError("email", "Invalid format", "INVALID_EMAIL"),
  ValidationError("password", "Too short", "PASSWORD_TOO_SHORT")
))

// Ğ ĞµÑÑƒÑ€Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½
throw NotFoundException("Switch", switchId)

// Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½
throw ForbiddenException.resourceOwnershipRequired()

// ĞĞµĞ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½
throw UnauthorizedException.invalidCredentials()

// ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
throw BadRequestException.invalidUuid("id")
----

== ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ·Ğ°Ğ´Ğ°ÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ (Ñ„Ğ°Ğ¹Ğ» `.env`):

[source,properties]
----
# HTTP Server
HTTP_HOST=0.0.0.0
HTTP_PORT=8080

# Database
DB_HOST=localhost
DB_PORT=5432
DB_DATABASE=switchapi
DB_USER=switchapi
DB_PASSWORD=switchapi

# JWT
JWT_SECRET=your-secret-key-here
JWT_EXPIRATION_TIME=604800000  # 7 Ğ´Ğ½ĞµĞ¹ Ğ² Ğ¼Ğ¸Ğ»Ğ»Ğ¸ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ…

# Logging
LOG_LEVEL=INFO
----

== EventBus Addresses

[cols="2,3"]
|===
| Address | Description

| `db.user.create`
| Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

| `db.user.getById`
| ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ğ¾ ID

| `db.user.getByEmail`
| ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ğ¾ email

| `db.switch.create`
| Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ switch

| `db.switch.getById`
| ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ switch Ğ¿Ğ¾ ID

| `db.switch.getByUser`
| ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ switches Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

| `db.switch.getByPublicCode`
| ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ switch Ğ¿Ğ¾ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ¼Ñƒ ĞºĞ¾Ğ´Ñƒ

| `db.switch.update`
| ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ switch

| `db.switch.delete`
| Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ switch
|===

== Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

ĞŸÑ€Ğ¾ĞµĞºÑ‚ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ°Ğ¼Ğ¸ (34 Ñ‚ĞµÑÑ‚Ğ°):

[cols="2,1"]
|===
| Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ | Ğ¢ĞµÑÑ‚Ñ‹

| `ConfigLoaderTest`
| 2

| `TestMainVerticle`
| 1

| `AuthHandlerTest`
| 4

| `HealthHandlerTest`
| 1

| `SwitchHandlerTest`
| 16

| `PublicSwitchHandlerTest`
| 5

| `JwtAuthMiddlewareTest`
| 5

| *Ğ˜Ñ‚Ğ¾Ğ³Ğ¾*
| *34 âœ…*
|===

=== Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ‚ĞµÑÑ‚Ğ¾Ğ²

[source,bash]
----
# Ğ’ÑĞµ Ñ‚ĞµÑÑ‚Ñ‹
./gradlew cleanTest test

# ĞšĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚
./gradlew test --tests "SwitchHandlerTest"

# Ğ¡ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ¾Ğ¼
./gradlew test --info
----

== Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº

* *Ğ¯Ğ·Ñ‹Ğº:* Kotlin 2.1.0
* *JVM:* OpenJDK 21
* *Ğ¤Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº:* Vert.x 5.0.6
* *Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:* PostgreSQL 16
* *ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ:* JWT (vert.x-auth-jwt)
* *Ğ¥ĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ĞµĞ¹:* Argon2id
* *Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ:* OpenAPI 3.1 (vert.x-web-openapi-router)
* *Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:* JUnit 5, Vert.x JUnit5
* *Ğ¡Ğ±Ğ¾Ñ€ĞºĞ°:* Gradle 8.5

== ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ ÑÑÑ‹Ğ»ĞºĞ¸

* https://vertx.io/docs/[Vert.x Documentation]
* https://kotlin.github.io/kotlinx.coroutines/[Kotlin Coroutines]
* https://swagger.io/specification/[OpenAPI Specification]
* https://stackoverflow.com/questions/tagged/vert.x[Vert.x on Stack Overflow]
* https://discord.gg/6ry7aqPWXy[Vert.x Discord]

== Ğ›Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ

MIT
